/** 
 * datatable v3.0.3
 * 
 * author : yonyou FED
 * homepage : https://github.com/iuap-design/datatable#readme
 * bugs : https://github.com/iuap-design/datatable/issues
 **/ 
u.GridAdapter=u.BaseAdapter.extend({initialize:function(options){var opt=options.options||{},viewModel=options.model,element="string"==typeof options.el?document.querySelector(options.el):options.el,app=options.app;this.id=opt.id,options=opt;var oThis=this,compDiv=null,comp=null;this.dataTable=u.getJSObject(viewModel,options.data),this.element=element,this.$element=$(element),this.editComponentDiv={},this.editComponent={},this.id=options.id,this.gridOptions=options,this.gridOptions.onBeforeRowSelected=u.getFunction(viewModel,this.gridOptions.onBeforeRowSelected),this.gridOptions.onRowSelected=u.getFunction(viewModel,this.gridOptions.onRowSelected),this.gridOptions.onBeforeRowUnSelected=u.getFunction(viewModel,this.gridOptions.onBeforeRowUnSelected),this.gridOptions.onRowUnSelected=u.getFunction(viewModel,this.gridOptions.onRowUnSelected),this.gridOptions.onBeforeAllRowSelected=u.getFunction(viewModel,this.gridOptions.onBeforeAllRowSelected),this.gridOptions.onAllRowSelected=u.getFunction(viewModel,this.gridOptions.onAllRowSelected),this.gridOptions.onBeforeAllRowUnSelected=u.getFunction(viewModel,this.gridOptions.onBeforeAllRowUnSelected),this.gridOptions.onAllRowUnSelected=u.getFunction(viewModel,this.gridOptions.onAllRowUnSelected),this.gridOptions.onBeforeRowFocus=u.getFunction(viewModel,this.gridOptions.onBeforeRowFocus),this.gridOptions.onRowFocus=u.getFunction(viewModel,this.gridOptions.onRowFocus),this.gridOptions.onBeforeRowUnFocus=u.getFunction(viewModel,this.gridOptions.onBeforeRowUnFocus),this.gridOptions.onRowUnFocus=u.getFunction(viewModel,this.gridOptions.onRowUnFocus),this.gridOptions.onDblClickFun=u.getFunction(viewModel,this.gridOptions.onDblClickFun),this.gridOptions.onValueChange=u.getFunction(viewModel,this.gridOptions.onValueChange),this.gridOptions.onBeforeClickFun=u.getFunction(viewModel,this.gridOptions.onBeforeClickFun),this.gridOptions.onBeforeEditFun=u.getFunction(viewModel,this.gridOptions.onBeforeEditFun),this.gridOptions.onRowHover=u.getFunction(viewModel,this.gridOptions.onRowHover);var columns=[];$("div",this.$element).each(function(){var ops=$(this).attr("options");if("undefined"==typeof ops)var column=eval("("+ops+")");else var column=JSON.parse(ops);var eType=u.getFunction(viewModel,column.editType),rType=u.getFunction(viewModel,column.renderType),afterEType=u.getFunction(viewModel,column.afterEType),afterRType=u.getFunction(viewModel,column.afterRType),sumRenderType=u.getFunction(viewModel,column.sumRenderType);column.sumRenderType=sumRenderType;var eOptions={};if(column.editOptions)if("undefined"==typeof column.editOptions)var eOptions=eval("("+column.editOptions+")");else var eOptions=column.editOptions;eOptions.data=options.data,eOptions.field=column.field,""==eType&&(eType="string"),"string"==eType||"integer"==eType||"checkbox"==eType||"combo"==eType||"radio"==eType||"float"==eType||"currency"==eType||"datetime"==eType||"date"==eType||"time"==eType||"url"==eType||"password"==eType||"percent"==eType?(oThis.createDefaultEdit(eType,eOptions,options,viewModel,column),column.editType=function(e){oThis.editComponentDiv[column.field]&&oThis.editComponentDiv[column.field][0].childNodes.length>0||oThis.createDefaultEdit(eType,eOptions,options,viewModel,column);var t=oThis.editComponent[column.field];if(!t)return void $(e.element).parent().focus();e.element.innerHTML="";oThis.getDataTableRow(e.rowObj);$(e.element).append(oThis.editComponentDiv[column.field]),t.required&&$(e.element).parent().parent().find(".u-grid-edit-mustFlag").show(),$(e.element).parent().focus(),t.modelValueChange(e.value),"function"==typeof afterEType&&afterEType.call(this,e)}):"function"==typeof eType&&(column.editType=eType),"booleanRender"==rType?column.renderType=function(e){var t="";"Y"==e.value&&(t="checked");var i='<input type="checkbox"   style="cursor:default;" disabled '+t+">";e.element.innerHTML=i,"function"==typeof afterRType&&afterRType.call(this,e)}:"integerRender"==rType?column.renderType=function(e){var t=e.gridObj,i=e.gridCompColumn,o=i.options.field;e.element.innerHTML=e.value,$("#"+t.options.id+"_header_table").find('th[field="'+o+'"]').css("text-align","right"),$(e.element).css("text-align","right"),$(e.element).css("color","#e33c37"),$(e.element).find(".u-grid-header-link").css("padding-right","3em"),"function"==typeof afterRType&&afterRType.call(this,e)}:"currencyRender"==rType?column.renderType=function(e){var t=e.gridObj,i=e.gridCompColumn,o=i.options.field,n=e.rowIndex,a=t.dataTable,r=$(t.dataSourceObj.rows[n].value).attr("$_#_@_id"),d=a.getRowByRowId(r);if(d){var s=d.getMeta(o,"precision"),l=iweb.Core.getMaskerMeta("float")||{},p="number"==typeof parseFloat(s)?s:l.precision;l.precision=p,l.precision=p||l.precision;var c=new u.NumberFormater(l.precision),m=new u.NumberMasker(l),g=m.format(c.format(e.value)).value;e.element.innerHTML=g,$("#"+t.options.id+"_header_table").find('th[field="'+o+'"]').css("text-align","right"),$(e.element).css("text-align","right"),$(e.element).css("color","#e33c37"),$(e.element).find(".u-grid-header-link").css("padding-right","3em"),$(e.element).attr("title",g),"function"==typeof afterRType&&afterRType.call(this,e)}}:"floatRender"==rType?column.renderType=function(e){var t=e.gridObj,i=e.gridCompColumn,o=i.options.field,n=e.rowIndex,a=t.dataTable,r=$(t.dataSourceObj.rows[n].value).attr("$_#_@_id"),d=a.getRowByRowId(r);if(d){var s=d.getMeta(o,"precision")||i.options.precision,l=iweb.Core.getMaskerMeta("float")||{},p="number"==typeof parseFloat(s)?s:l.precision;l.precision=p;var c=new u.NumberFormater(l.precision),m=new u.NumberMasker(l),g=m.format(c.format(e.value)).value;e.element.innerHTML=g,$("#"+t.options.id+"_header_table").find('th[field="'+o+'"]').css("text-align","right"),$(e.element).css("text-align","right"),$(e.element).css("color","#e33c37"),$(e.element).find(".u-grid-header-link").css("padding-right","3em"),$(e.element).attr("title",g),"function"==typeof afterRType&&afterRType.call(this,e)}}:"comboRender"==rType?column.renderType=function(e){var t=u.getJSObject(viewModel,eOptions.datasource);e.element.innerHTML="",o&&(o.length=0);for(var i=e.value.split(","),o=[],n=0,a=t.length;n<a;n++)for(var r=0;r<i.length;r++)t[n].value==i[r]&&o.push(t[n].name);var d=o.toString();d||(d=e.value),e.element.innerHTML=d,$(e.element).attr("title",d),"function"==typeof afterRType&&afterRType.call(this,e)}:"dateRender"==rType?column.renderType=function(e){var t=u.dateRender(e.value,e.gridCompColumn.options.format);e.element.innerHTML=t,$(e.element).attr("title",t),"function"==typeof afterRType&&afterRType.call(this,e)}:"dateTimeRender"==rType?column.renderType=function(e){var t=u.dateTimeRender(e.value);e.element.innerHTML=t,$(e.element).attr("title",t),"function"==typeof afterRType&&afterRType.call(this,e)}:"function"==typeof rType?column.renderType=rType:"radioRender"==rType?column.renderType=function(e){var t=u.getJSObject(viewModel,eOptions.datasource),i=e.value,o=$('<div class="u-grid-edit-item-radio"></div>');e.element.innerHTML="",$(e.element).append(o);for(var n=0;n<t.length;n++)t[n].pk==i?o.append('<input name="'+column.field+e.row.value["$_#_@_id"]+'" type="radio" value="'+t[n].pk+'" checked="true" /><i data-role="name">'+t[n].name+"</i>"):o.append('<input name="'+column.field+e.row.value["$_#_@_id"]+'" type="radio" value="'+t[n].pk+'"/><i data-role="name">'+t[n].name+"</i>");o.find(":radio").each(function(){$(this).on("click",function(){var t=this.value;o.find(":radio").each(function(){this.value==t?this.checked=!0:this.checked=!1});var i=e.gridObj,n=e.gridCompColumn,a=n.options.field,r=i.dataTable,d=e.row.value["$_#_@_id"],s=r.getRowByRowId(d);s.setValue(a,t)})}),"function"==typeof afterRType&&afterRType.call(this,obj)}:"urlRender"==rType?column.renderType=function(e){e.element.innerHTML='<a href="'+e.value+'" target="_blank">'+e.value+"</a>","function"==typeof afterRType&&afterRType.call(this,e)}:"passwordRender"==rType?column.renderType=function(e){e.element.innerHTML='<input type="password" disable="true" readonly="readonly" style="border:0px;background:none;padding:0px;" value="'+e.value+'" title=""><span class="fa fa-eye right-span" ></span>';var t=e.element.querySelector("span"),i=e.element.querySelector("input");i.value=e.value,$(t).on("click",function(){"password"==i.type?i.type="text":i.type="password"}),"function"==typeof afterRType&&afterRType.call(this,e)}:"percentRender"==rType&&(column.renderType=function(e){var t=e.gridObj,i=e.gridCompColumn,o=i.options.field,n=e.rowIndex,a=t.dataTable,r=$(t.dataSourceObj.rows[n].value).attr("$_#_@_id"),d=a.getRowByRowId(r);if(d){var s=d.getMeta(o,"precision")||i.options.precision,l=iweb.Core.getMaskerMeta("percent")||{},p="number"==typeof parseFloat(s)?s:l.precision;l.precision=p,l.precision&&(l.precision=parseInt(l.precision)+2);var c=new u.NumberFormater(l.precision),m=new u.PercentMasker(l),g=m.format(c.format(e.value)).value;e.element.innerHTML=g,$(e.element).css("text-align","right"),$(e.element).attr("title",g),"function"==typeof afterRType&&afterRType.call(this,e)}});var defineSumRenderType=column.sumRenderType;column.sumRenderType=function(e){e.value=parseFloat(e.value);var t=e.gridObj,i=e.gridCompColumn,o=i.options.precision,n=iweb.Core.getMaskerMeta("float")||{},a=0==o||o&&"number"==typeof parseFloat(o)?o:n.precision;n.precision=a;var r=new u.NumberFormater(n.precision),d=new u.NumberMasker(n),s=d.format(r.format(e.value)).value;e.element.innerHTML=s,$(e.element).parent().css("text-align","right"),$(e.element).css("text-align","right"),$(e.element).attr("title",s),"function"==typeof defineSumRenderType&&defineSumRenderType.call(t,e)},columns.push(column)}),app&&app.adjustFunc&&app.adjustFunc.call(app,{id:this.id,type:"gridColumn",columns:columns}),this.gridOptions.columns=columns;var onRowSelectedFun=this.gridOptions.onRowSelected;this.gridOptions.onRowSelected=function(e){var t=oThis.grid.dataSourceObj.rows[e.rowIndex].value["$_#_@_id"],i=oThis.dataTable.getIndexByRowId(t);oThis.grid.options.multiSelect?oThis.dataTable.addRowsSelect([i]):oThis.dataTable.setRowSelect(i),onRowSelectedFun&&onRowSelectedFun.call(oThis,e)},this.dataTable.on(u.DataTable.ON_ROW_SELECT,function(e){$.each(e.rowIds,function(){var e=oThis.grid.getRowIndexByValue("$_#_@_id",this),t=!0;e>-1&&(t=oThis.grid.setRowSelect(parseInt(e)),t||oThis.dataTable.setRowUnSelect(oThis.dataTable.getIndexByRowId(this)))})}),this.dataTable.on(u.DataTable.ON_ROW_ALLSELECT,function(e){oThis.grid.setAllRowSelect()}),this.dataTable.on(u.DataTable.ON_ROW_ALLUNSELECT,function(e){oThis.grid.setAllRowUnSelect()});var onRowUnSelectedFun=this.gridOptions.onRowUnSelected;this.gridOptions.onRowUnSelected=function(e){var t=oThis.grid.dataSourceObj.rows[e.rowIndex].value["$_#_@_id"],i=oThis.dataTable.getIndexByRowId(t);oThis.dataTable.setRowUnSelect(i),onRowUnSelectedFun&&onRowUnSelectedFun.call(oThis,e)},this.dataTable.on(u.DataTable.ON_ROW_UNSELECT,function(e){$.each(e.rowIds,function(){var e=oThis.grid.getRowIndexByValue("$_#_@_id",this),t=!0;e>-1&&(t=oThis.grid.setRowUnselect(parseInt(e)),t||(oThis.grid.options.multiSelect?oThis.dataTable.addRowsSelect([oThis.dataTable.getIndexByRowId(this)]):oThis.dataTable.setRowSelect(oThis.dataTable.getIndexByRowId(this))))})});var onRowFocusFun=this.gridOptions.onRowFocus;this.gridOptions.onRowFocus=function(e){var t=oThis.grid.dataSourceObj.rows[e.rowIndex].value["$_#_@_id"],i=oThis.dataTable.getIndexByRowId(t);oThis.grid.options.rowClickBan?oThis.dataTable.setRowFocus(i,!0):oThis.dataTable.setRowFocus(i),onRowFocusFun&&onRowFocusFun.call(oThis,e)},this.dataTable.on(u.DataTable.ON_ROW_FOCUS,function(e){var t=oThis.grid.getRowIndexByValue("$_#_@_id",e.rowId),i=!0;t>-1&&(i=oThis.grid.setRowFocus(parseInt(t)),i||oThis.dataTable.setRowUnFocus(oThis.dataTable.getIndexByRowId(e.rowId)))});var onRowUnFocusFun=this.gridOptions.onRowUnFocus;this.gridOptions.onRowUnFocus=function(e){var t=oThis.grid.dataSourceObj.rows[e.rowIndex].value["$_#_@_id"],i=oThis.dataTable.getIndexByRowId(t);oThis.dataTable.setRowUnFocus(i),onRowUnFocusFun&&onRowUnFocusFun.call(oThis,e)},this.dataTable.on(u.DataTable.ON_ROW_UNFOCUS,function(e){var t=oThis.grid.getRowIndexByValue("$_#_@_id",e.rowId),i=!0;t>-1&&(i=oThis.grid.setRowUnFocus(parseInt(t)),i||oThis.dataTable.setRowFocus(oThis.dataTable.getIndexByRowId(e.rowId)))}),this.dataTable.on(u.DataTable.ON_INSERT,function(e){var t=new Array;$.each(e.rows,function(){var e=this.data,i=this.rowId,o={};for(var n in e)o[n]=e[n].value;o["$_#_@_id"]=i,t.push(o)}),oThis.grid.addRows(t,e.index)}),this.dataTable.on(u.DataTable.ON_UPDATE,function(e){$.each(e.rows,function(){var e=this.data,t=this.rowId,i={};for(var o in e)i[o]=e[o].value;i["$_#_@_id"]=t;var n=oThis.grid.getRowIndexByValue("$_#_@_id",t);oThis.grid.updateRow(n,i)})}),this.dataTable.on(u.DataTable.ON_VALUE_CHANGE,function(e){var t=e.rowId,i=oThis.grid.getRowIndexByValue("$_#_@_id",t);if(i!=-1){var o=e.field,n=e.newValue;oThis.grid.updateValueAt(i,o,n)}}),this.dataTable.on(u.DataTable.ON_DELETE,function(e){var t=new Array;$.each(e.rowIds,function(){var e=oThis.grid.getRowIndexByValue("$_#_@_id",this);t.push(e)}),oThis.grid.deleteRows(t)}),this.dataTable.on(u.DataTable.ON_DELETE_ALL,function(e){oThis.grid.setDataSource({})});var onValueChangeFun=this.gridOptions.onValueChange;this.gridOptions.onValueChange=function(e){var t=oThis.getDataTableRow(oThis.grid.dataSourceObj.rows[e.rowIndex].value);t&&("object"==$.type(e.newValue)?(t.setValue(e.field,e.newValue.trueValue),t.setMeta(e.field,"display",e.newValue.showValue)):t.setValue(e.field,e.newValue)),onValueChangeFun&&onValueChangeFun.call(oThis,e)},this.dataTable.on("valueChange",function(e){var t=e.field,i=e.rowId,o=(e.oldValue,e.newValue),n=oThis.grid.getRowIndexByValue("$_#_@_id",i);n>-1&&oThis.grid.updateValueAt(n,t,o)}),this.dataTable.on(u.DataTable.ON_LOAD,function(e){if(e.length>0){var t=new Array;$.each(e,function(){var e={},i=this.data,o=this.rowId;for(var n in i){var a=i[n].value;e[n]=a}e["$_#_@_id"]=o,t.push(e)});var i={};i.values=t,oThis.grid.setDataSource(i)}}),this.dataTable.on(u.DataTable.ON_ENABLE_CHANGE,function(e){oThis.grid.setEditable(e.enable)}),this.dataTable.on(u.DataTable.ON_ROW_META_CHANGE,function(e){var t=e.field,i=e.meta,o=e.row,n=e.newValue;if("required"==i&&oThis.grid.setRequired(t,n),"precision"==i){var a=oThis.editComponent[t];a&&a.setPrecision(n);var r=oThis.grid.getRowIndexByValue("$_#_@_id",o.rowId);if(r==-1)return;var d=o.getValue(t);oThis.grid.updateValueAt(r,t,d,!0)}}),this.dataTable.on(u.DataTable.ON_META_CHANGE,function(e){var t=e.field,i=e.meta;"precision"==i&&oThis.grid.renderTypeFun({field:t})}),this.gridOptions.transMap={ml_show_column:trans("gridComp.show_column","显示/隐藏列"),ml_clear_set:trans("gridComp.clear_set","清除设置"),ml_no_rows:trans("gridComp.no_rows","无数据"),ml_sum:trans("gridComp.sum","合计:"),ml_close:trans("gridComp.close","关闭")},this.grid=$(element).grid(this.gridOptions),this.grid.dataTable=this.dataTable,this.grid.viewModel=viewModel,this.grid.gridModel=this;var data=this.dataTable.rows();if(data.length>0){var values=new Array;$.each(data,function(){var e={},t=this.data,i=this.rowId;for(var o in t){var n=t[o].value;e[o]=n}e["$_#_@_id"]=i,values.push(e)});var dataSource={};dataSource.values=values,oThis.grid.setDataSource(dataSource)}var selectIndexs=this.dataTable.getSelectedIndexs();return selectIndexs.length>0&&$.each(selectIndexs,function(){oThis.grid.setRowSelect(this)}),this},getName:function(){return"grid"},createDefaultEdit:function(e,t,i,o,n){var a=this;"string"==e?(compDiv=$('<div><input type="text" class="u-grid-edit-item-string"></div>'),i.editType&&"default"!=i.editType||compDiv.addClass("eType-input"),t.dataType="string",comp=new u.StringAdapter({el:compDiv[0],options:t,model:o})):"integer"==e?(compDiv=$('<div><input type="text" class="u-grid-edit-item-integer"></div>'),i.editType&&"default"!=i.editType||compDiv.addClass("eType-input"),t.dataType="integer",comp=new u.IntegerAdapter({el:compDiv[0],options:t,model:o})):"checkbox"==e?(compDiv=$('<div><input id="'+a.id+"_edit_field_"+n.field+'" type="checkbox" class="u-grid-edit-item-checkbox"></div>'),$.CheckboxComp?comp=new $.CheckboxComp(compDiv.find("input")[0],t,o):comp=new u.CheckboxAdapter({el:compDiv[0],options:t,model:o})):"combo"==e?(compDiv=$('<div class="eType-input"><input type="text" class="u-grid-edit-item-float"></div>'),$.Combobox?(compDiv=$('<div class="input-group  form_date u-grid-edit-item-comb"><div  type="text" class="form-control grid-combox"></div><i class="input-group-addon" ><i class="fa fa-angle-down"></i></i></div>'),comp=new $.Combobox(compDiv[0],t,o)):(comp=new u.ComboboxAdapter({el:compDiv[0],options:t,model:o}),a.gridOptions.customEditPanelClass?a.gridOptions.customEditPanelClass.indexOf("u-combo-ul")<0&&(a.gridOptions.customEditPanelClass+=",u-combo-ul"):a.gridOptions.customEditPanelClass="u-combo-ul")):"radio"==e?i.editType&&"default"!=i.editType?(compDiv=$('<div class="u-grid-edit-item-radio"><input type="radio" name="identity" /><i data-role="name"></i></div>'),comp=new u.RadioAdapter({el:compDiv[0],options:t,model:o})):(compDiv=null,comp=null):"float"==e?(compDiv=$('<div><input type="text" class="u-grid-edit-item-float"></div>'),i.editType&&"default"!=i.editType||compDiv.addClass("eType-input"),t.dataType="float",comp=new u.FloatAdapter({el:compDiv[0],options:t,model:o})):"currency"==e?(compDiv=$('<div><input type="text" class="u-grid-edit-item-currency"></div>'),i.editType&&"default"!=i.editType||compDiv.addClass("eType-input"),t.dataType="currency",comp=new u.CurrencyAdapter({el:compDiv[0],options:t,model:o})):"datetime"==e?(compDiv=$('<div class="input-group u-grid-edit-item-datetime" ><input class="form-control" /><span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span></div>'),$.DateTime?comp=new $.DateTime(compDiv[0],t,o):(comp=new u.DateTimeAdapter({el:compDiv[0],options:t,model:o}),a.gridOptions.customEditPanelClass?a.gridOptions.customEditPanelClass.indexOf("u-date-panel")<0&&(a.gridOptions.customEditPanelClass+=",u-date-panel"):a.gridOptions.customEditPanelClass="u-date-panel")):"date"==e?(compDiv=$('<div class="input-group u-grid-edit-item-date" ><input class="form-control" /><span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span></div>'),$.DateComp?comp=new $.DateComp(compDiv[0],t,o):(t.type="u-date",comp=new u.DateTimeAdapter({el:compDiv[0],options:t,model:o}),a.gridOptions.customEditPanelClass?a.gridOptions.customEditPanelClass.indexOf("u-date-panel")<0&&(a.gridOptions.customEditPanelClass+=",u-date-panel"):a.gridOptions.customEditPanelClass="u-date-panel")):"url"==e?(compDiv=$('<div><input type="text" class="u-grid-edit-item-string"></div>'),i.editType&&"default"!=i.editType||compDiv.addClass("eType-input"),t.dataType="url",comp=new u.UrlAdapter({el:compDiv[0],options:t,model:o})):"password"==e?(compDiv=$('<div><input type="text" class="u-grid-edit-item-string"><span class="fa fa-eye right-span"></span></div>'),i.editType&&"default"!=i.editType||compDiv.addClass("eType-input"),t.dataType="password",comp=new u.PassWordAdapter({el:compDiv[0],options:t,model:o})):"percent"==e&&(compDiv=$('<div><input type="text" class="u-grid-edit-item-float"></div>'),i.editType&&"default"!=i.editType||compDiv.addClass("eType-input"),t.dataType="precent",comp=new u.PercentAdapter({el:compDiv[0],options:t,model:o})),$("input",$(compDiv)).on("blur",function(e){a.grid.nextEditShow()}),comp&&comp.dataAdapter&&(comp=comp.dataAdapter),a.editComponentDiv[n.field]=compDiv,a.editComponent[n.field]=comp},getDataTableRow:function(e){var t=e["$_#_@_id"],i=null,o=this.dataTable.getIndexByRowId(t);return o>-1&&(i=this.dataTable.getRow(o)),i},setEnable:function(e){this.grid.setEditable(e)},setShowHeader:function(e){this.grid.setShowHeader(e)},editRowFun:function(e){this.dataTable.setRowSelect(e),this.grid.editRowIndexFun(e)},doValidate:function(options){for(var rows=this.grid.dataSourceObj.rows,gridColumnArr=this.grid.gridCompColumnArr,passed=!0,MsgArr=new Array,evalStr="",rowMsg="",wholeMsg="",columnShowMsg="",j=0;j<gridColumnArr.length;j++){for(var column=gridColumnArr[j],columnOptions=gridColumnArr[j].options,field=columnOptions.field,title=columnOptions.title,required=columnOptions.required,validType=columnOptions.editOptions.validType,placement=columnOptions.editOptions.placement,tipId=columnOptions.editOptions.tipId,errorMsg=columnOptions.editOptions.errorMsg,nullMsg=columnOptions.editOptions.nullMsg,maxLength=columnOptions.editOptions.maxLength,minLength=columnOptions.editOptions.minLength,max=columnOptions.editOptions.max,min=columnOptions.editOptions.min,maxNotEq=columnOptions.editOptions.maxNotEq,minNotEq=columnOptions.editOptions.minNotEq,reg=columnOptions.editOptions.regExp,columnPassedFlag=!0,columnMsg="",validate=new u.Validate({el:this.element,single:!0,required:required,validType:validType,placement:placement,tipId:tipId,errorMsg:errorMsg,nullMsg:nullMsg,maxLength:maxLength,minLength:minLength,max:max,min:min,maxNotEq:maxNotEq,minNotEq:minNotEq,reg:reg}),i=0;i<rows.length;i++){var value=rows[i].value[field],result=validate.check({pValue:value,showMsg:!1});if(passed=result.passed&&passed,!result.passed){columnPassedFlag=!1,options.showMsg&&columnMsg.indexOf(result.Msg)<0&&(columnMsg+=result.Msg+" ");var index=this.grid.getIndexOfColumn(column),contentDiv=document.getElementById(this.grid.options.id+"_content_tbody"),row=contentDiv.querySelectorAll("tr")[i],td=row.querySelectorAll("td")[index],div=td.querySelector("div");u.addClass(td,"u-grid-err-td"),u.addClass(div,"u-grid-err-td"),evalStr="if(typeof obj"+i+" == 'undefined'){var obj"+i+"= {}; MsgArr.push(obj"+i+");obj"+i+".rowNum = "+i+"; obj"+i+".arr = new Array();}",eval(evalStr);var msg="("+title+")"+result.Msg+";";evalStr="obj"+i+".arr.push(msg)",eval(evalStr)}}!columnPassedFlag&&options.showMsg&&(columnShowMsg+=title+":"+columnMsg+"<br>")}columnShowMsg&&u.showMessage({msg:columnShowMsg,showSeconds:3}),MsgArr.length>0&&MsgArr.sort(function(e,t){return e.rowNum>t.rowNum?1:-1});for(var k=0;k<MsgArr.length;k++){var rowNum=MsgArr[k].rowNum;rowMsg=MsgArr[k].arr.join(""),wholeMsg+="第"+(rowNum+1)+"行:"+rowMsg}return{passed:passed,comp:this,Msg:wholeMsg}}}),u.compMgr.addDataAdapter({adapter:u.GridAdapter,name:"grid"});